<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Simple Supabase CRUD App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  </head>
  <body class="bg-gray-100 text-gray-900">
    <div class="max-w-2xl mx-auto mt-10 bg-white p-6 rounded-lg shadow">
      <h1 class="text-2xl font-bold text-center mb-6">Supabase CRUD Demo</h1>

      <!-- Login / Signup -->
      <div id="auth-section">
        <input
          id="email"
          type="email"
          placeholder="Email"
          class="border p-2 w-full mb-2 rounded"
        />
        <input
          id="password"
          type="password"
          placeholder="Password"
          class="border p-2 w-full mb-4 rounded"
        />
        <button
          id="loginBtn"
          class="bg-blue-600 text-white px-4 py-2 rounded w-full mb-2"
        >
          Login
        </button>
        <button
          id="signupBtn"
          class="bg-green-600 text-white px-4 py-2 rounded w-full"
        >
          Sign Up
        </button>
      </div>

      <!-- CRUD Section -->
      <div id="app-section" class="hidden">
        <div class="flex justify-between mb-4">
          <h2 class="text-xl font-semibold">Your Records</h2>
          <button
            id="logoutBtn"
            class="bg-red-500 text-white px-3 py-1 rounded"
          >
            Logout
          </button>
        </div>

        <div class="flex gap-2 mb-4">
          <input
            id="title"
            placeholder="Title"
            class="border p-2 flex-1 rounded"
          />
          <input
            id="description"
            placeholder="Description"
            class="border p-2 flex-1 rounded"
          />
          <button id="addBtn" class="bg-blue-600 text-white px-4 rounded">
            Add
          </button>
        </div>

        <ul id="recordsList" class="space-y-2"></ul>
      </div>
    </div>

    <script>
      const SUPABASE_URL = "https://rnphputikyzilhxsmtrp.supabase.co";
      const SUPABASE_KEY =
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJucGhwdXRpa3l6aWxoeHNtdHJwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIwMDc5MTIsImV4cCI6MjA3NzU4MzkxMn0.fV-dFs6L_r7ZZx4tXeJNvPsLfey332qiLysUVsTY-a8";
      const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

      const authSection = document.getElementById("auth-section");
      const appSection = document.getElementById("app-section");
      const recordsList = document.getElementById("recordsList");

      const emailInput = document.getElementById("email");
      const passwordInput = document.getElementById("password");
      const titleInput = document.getElementById("title");
      const descInput = document.getElementById("description");

      // ---- Auth ----
      async function signUp() {
        const { data, error } = await supabase.auth.signUp({
          email: emailInput.value,
          password: passwordInput.value,
        });
        if (error) alert(error.message);
        else alert("Signup successful! You can now log in.");
      }

      async function login() {
        const { data, error } = await supabase.auth.signInWithPassword({
          email: emailInput.value,
          password: passwordInput.value,
        });
        if (error) alert(error.message);
        else showApp();
      }

      async function logout() {
        await supabase.auth.signOut();
        appSection.classList.add("hidden");
        authSection.classList.remove("hidden");
      }

      // ---- CRUD ----
      async function loadRecords() {
        const {
          data: { user },
        } = await supabase.auth.getUser();
        const { data, error } = await supabase
          .from("records")
          .select("*")
          .eq("user_id", user.id);
        if (error) {
          alert(error.message);
          return;
        }

        recordsList.innerHTML = "";
        data.forEach((rec) => {
          const li = document.createElement("li");
          li.className = "border p-2 rounded flex justify-between items-center";
          li.innerHTML = `
          <div>
            <strong>${rec.title}</strong><br>${rec.description || ""}
          </div>
          <div class="space-x-2">
            <button class="bg-yellow-400 px-2 py-1 rounded" onclick="editRecord(${
              rec.id
            }, '${rec.title}', '${rec.description || ""}')">Edit</button>
            <button class="bg-red-500 text-white px-2 py-1 rounded" onclick="deleteRecord(${
              rec.id
            })">Delete</button>
          </div>
        `;
          recordsList.appendChild(li);
        });
      }

      async function addRecord() {
        const { data, error } = await supabase.from("records").insert({
          title: titleInput.value,
          description: descInput.value,
        });
        if (error) alert(error.message);
        else {
          titleInput.value = "";
          descInput.value = "";
          loadRecords();
        }
      }

      async function editRecord(id, title, desc) {
        const newTitle = prompt("Edit title:", title);
        const newDesc = prompt("Edit description:", desc);
        if (newTitle === null) return;
        const { error } = await supabase
          .from("records")
          .update({ title: newTitle, description: newDesc })
          .eq("id", id);
        if (error) alert(error.message);
        else loadRecords();
      }

      async function deleteRecord(id) {
        const { error } = await supabase.from("records").delete().eq("id", id);
        if (error) alert(error.message);
        else loadRecords();
      }

      // ---- UI Control ----
      async function showApp() {
        authSection.classList.add("hidden");
        appSection.classList.remove("hidden");
        loadRecords();
      }

      // ---- Event Listeners ----
      document.getElementById("signupBtn").onclick = signUp;
      document.getElementById("loginBtn").onclick = login;
      document.getElementById("logoutBtn").onclick = logout;
      document.getElementById("addBtn").onclick = addRecord;

      // Check if already logged in
      supabase.auth.onAuthStateChange((_event, session) => {
        if (session) showApp();
        else {
          authSection.classList.remove("hidden");
          appSection.classList.add("hidden");
        }
      });
    </script>
  </body>
</html>
